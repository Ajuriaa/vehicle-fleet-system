<div class="container">
  <p class="title">Crear Registro de Bitácora</p>
  <form [formGroup]="logForm" class="driver-form" *ngIf="!showTable">
    <mat-form-field class="field">
      <mat-label class="label">Vehículo</mat-label>
      <input
        matInput
        required
        [readonly]="readonly"
        class="input"
        [matAutocomplete]="autoVehicle"
        formControlName="vehicle"
        placeholder="Ingrese el vehículo"
      >
      <mat-autocomplete #autoVehicle="matAutocomplete">
        @for (vehicle of filteredVehicles | async; track vehicle.ID_Vehiculo) {
          <mat-option [value]="vehicleInfoHelper.getModel(vehicle)" (click)="selectVehicle(vehicle)">
            {{ vehicleInfoHelper.getModel(vehicle) }}
          </mat-option>
        }
      </mat-autocomplete>
    </mat-form-field>
    <mat-form-field class="field">
      <mat-label class="label">Conductor</mat-label>
      <input
        matInput
        required
        class="input"
        [matAutocomplete]="autoDriver"
        formControlName="driver"
        placeholder="Ingrese el conductor"
      >
      <mat-autocomplete #autoDriver="matAutocomplete">
        @for (driver of filteredDrivers | async; track driver.ID_Conductor) {
          <mat-option [value]="driver.Nombre" (click)="selectDriver(driver)">
            {{ driver.Nombre }}
          </mat-option>
        }
      </mat-autocomplete>
    </mat-form-field>
  </form>

  <form [formGroup]="logDataForm" class="driver-form" *ngIf="showTable">
    <mat-form-field class="create-field">
      <input formControlName="Fecha" matInput [max]="maxDate" [matDatepicker]="picker" required>
      <mat-hint>DD/MM/YYYY</mat-hint>
      <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
      <mat-datepicker #picker></mat-datepicker>
    </mat-form-field>

    <mat-form-field class="create-field">
      <input
        matInput
        required
        class="input"
        formControlName="Destino"
      >
    </mat-form-field>

    <mat-form-field class="create-field">
      <input
        matInput
        required
        class="input"
        formControlName="Hora_Salida"
      >
    </mat-form-field>

    <mat-form-field class="create-field">
      <input
        matInput
        required
        class="input"
        formControlName="Hora_Entrada"
      >
    </mat-form-field>

    <mat-form-field class="create-field">
      <input
        matInput
        required
        type="number"
        class="input"
        formControlName="Kilometraje_Salida"
      >
    </mat-form-field>

    <mat-form-field class="create-field">
      <input
        matInput
        required
        type="number"
        class="input"
        formControlName="Kilometraje_Entrada"
      >
    </mat-form-field>

    <i class="uil uil-pump form-btn"></i>

    <mat-form-field class="create-field">
      <input
        matInput
        required
        type="number"
        class="input"
        formControlName="Pasajeros"
      >
    </mat-form-field>

    <mat-form-field class="create-field">
      <input
        matInput
        required
        type="number"
        class="input"
        formControlName="Observaciones"
      >
    </mat-form-field>

    <i class="uil uil-plus-circle  form-btn"></i>
  </form>

  <table mat-table [dataSource]="logs" class="table" *ngIf="showTable">
    <ng-container matColumnDef="date">
      <th mat-header-cell *matHeaderCellDef class="table-cell title">Fecha</th>
      <td mat-cell *matCellDef="let element" class="table-cell">
        {{ formatDate(element.Fecha) }}
      </td>
    </ng-container>

    <ng-container matColumnDef="destination">
      <th mat-header-cell *matHeaderCellDef class="table-cell title">Destino</th>
      <td mat-cell *matCellDef="let element" class="table-cell">
        {{ element.Destino }}
      </td>
    </ng-container>

    <ng-container matColumnDef="timeOut">
      <th mat-header-cell *matHeaderCellDef class="table-cell title">Hora Salida</th>
      <td mat-cell *matCellDef="let element" class="table-cell">
        {{ formatTime(element.Hora_Salida) }}
      </td>
    </ng-container>

    <ng-container matColumnDef="timeIn">
      <th mat-header-cell *matHeaderCellDef class="table-cell title">Hora Entrada</th>
      <td mat-cell *matCellDef="let element" class="table-cell">
        {{ formatTime(element.Hora_Entrada) }}
      </td>
    </ng-container>

    <ng-container matColumnDef="kmsOut">
      <th mat-header-cell *matHeaderCellDef class="table-cell title">Km Salida</th>
      <td mat-cell *matCellDef="let element" class="table-cell">
        {{ element.Kilometraje_Salida }}
      </td>
    </ng-container>

    <ng-container matColumnDef="kmsIn">
      <th mat-header-cell *matHeaderCellDef class="table-cell title">Km Entrada</th>
      <td mat-cell *matCellDef="let element" class="table-cell">
        {{ element.Kilometraje_Entrada }}
      </td>
    </ng-container>

    <ng-container matColumnDef="gas">
      <th mat-header-cell *matHeaderCellDef class="table-cell title">
        <i class="uil uil-pump"></i>
      </th>
      <td mat-cell *matCellDef="let element" class="table-cell">
        <i class="uil uil-pump gas" *ngIf="hasGasRefill()" ></i>
      </td>
    </ng-container>

    <ng-container matColumnDef="passengers">
      <th mat-header-cell *matHeaderCellDef class="table-cell title">Pasajeros</th>
      <td mat-cell *matCellDef="let element" class="table-cell">
        <i class="uil uil-users-alt"></i>
      </td>
    </ng-container>

    <ng-container matColumnDef="observation">
      <th mat-header-cell *matHeaderCellDef class="table-cell title">Observaciones</th>
      <td mat-cell *matCellDef="let element" class="table-cell">
        {{ element.Observaciones }}
      </td>
    </ng-container>

    <ng-container matColumnDef="delete">
      <th mat-header-cell *matHeaderCellDef class="table-cell title">Borrar</th>
      <td mat-cell *matCellDef="let element" class="table-cell">
        <i class="uil uil-trash-alt"></i>
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
  </table>

  <div class="buttons">
    <app-primary-button styleClass="btn-red" class="btn" (btnClick)="onCancel()">Cancelar</app-primary-button>
    <app-primary-button class="btn" *ngIf="!showTable" (btnClick)="showLogTable()">Siguiente</app-primary-button>
  </div>
</div>
